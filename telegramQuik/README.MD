Решение для отправки (получения) сообщений из терминала Квик в Телеграм (telegram bot api), отправка почты.

В решении используется библиотека Telegram.Bot https://github.com/TelegramBots/Telegram.Bot 

Консольная программа MessagesQServer.exe, выполняющая функцию Named Pipe Server и Telegram Bot, отправка почты.
Файл settings.ini должен быть расположен рядом с MessagesQServer.exe.

Тестовый скрипт test.lua

Необходимо обеспечить запуск MessagesQServer.exe.
Для запуска лучше использовать файл startTeleServer.bat. В нем происходит проверка, что сервер уже запущен.

Чтобы собрать MessagesQServer необходимо установить в проект пакет Telegram.Bot

В файле settings.ini необходимо заполнить токен, полученный при регистрации бота в телеграме.

ID Чата можно получить также через телеграм или можно отправить сообщение в созданном чате бота и сервер примет его и зарегестрируется на него.

Важно: для корректной работы в Windows 7 необходимо:
- Windows 7 SP1
- Установить дополнение https://support.microsoft.com/en-us/topic/update-to-enable-tls-1-1-and-tls-1-2-as-default-secure-protocols-in-winhttp-in-windows-c4bd73d2-31d7-761e-0178-11268bb10392

## Update.
Теперь проект (и собранная программа) называется MessagesQServer.
Помимо отправки сообщений в Телеграм добавлена возможность отправки почты.
Для этого необходимо включить отправку почты в настройках (значние ON), задать параметры smtp сервера.
Для отправки почты создается отдельный pipe канал (имя по умолчанию email_pipe).

Используя скрипт startTeleServer.bat при старте своего скрипта можно проверить, что сервер запущен, если нет, то запустить его.
Т.о. если он уже запущен не произойдет запуск дубля.

Для отправки emoji необходимо ввести код UTF символа в формате ##hex_number

Для примера символ 0x1F601 (U+1F601) задается как ##1F601

## Update 2022.02.03.
Новая версия, использующая Telegram.Bot v17.0.0 и C# 8.0

## Update 2023.04.05.
Чтение сообщений переведено на отдельный канал обмена. Для отправки сообщений используется имя канала как и ранее, например telegram_pipe.
Для чтения сообщений добавляется префикс out_telegram_pipe. В тест добавлен новый метод чтения сообщений.

Ссылка на собранные библиотеки https://yadi.sk/d/QLT64ucTaLrjTQ

Ссылка на собранные библиотеки с Telegram.Bot to v17.0.0 https://disk.yandex.ru/d/SuvCpLS6qVkMbg

Небольшое видео работы
https://youtu.be/14c4nQiDdfU

Пример настроек
https://youtu.be/Vy_m7qUwirY

## Update 2023.07.20.
Новая версия, использующая Telegram.Bot v19.0.0 и C# preview

Ссылка на собранные библиотеки с Telegram.Bot to v19.0.0 https://disk.yandex.ru/d/OtmUEQsAtEICfQ

## Update 2024.10.04
Новая версия, использующая Telegram.Bot v21.11.0

## Update 2025.03.16
Новая версия, использующая Telegram.Bot v22.4.4

Ссылка на собранные библиотеки с Telegram.Bot to v22.4.4 https://disk.yandex.ru/d/IltsoiI5oHjRkw

## Update 2025.08.09
Поддержка обмена JSON

Ссылка на собранные библиотеки с Telegram.Bot to v22.4.4 и поддержкой JSON обмена https://disk.360.yandex.ru/d/iHvDuII6y_k8CQ

Базовый формат - это отправить просто сообщение в виде текста. MessagesQServer его примет и отправит по заданным настройкам в файле параметров settings.ini
Этот формат отправки продолжат поддерживаться. Но теперь добавлен новый метод через JSON.

Теперь в lua скрипте может подготовить сообщение в формате JSON:

Для Телеграм:

    {
        "Message": "Текст сообщения",
        "Telegram": {
            "Token": "34535356363636"
            "ChatId": "123456789",
            "ReplyToMessageId": 123,
            "DisableNotification": true,
            "ParseMode": "Markdown"
        }
    }

Token задавать не обязательно, но задав его отличным от базового будет отправлено сообщение другому боту.

или для Email:

    {
        "Message": "Текст сообщения",
        "Email": {
            "Sender": "from@example.com",
            "Recipient": "to@example.com",
            "ToCopy": "to1@example.com;to2@example.com",
            "Subject": "Новая тема",
            "SmtpServer": "smtp.example.com",
            "ServerPort": 587,
            "Login": "user",
            "Password": "pass"
        }
    }

MessagesQServer его прочитает, определит что это JSON, разберет параметрыи отправит уже с ними, а не с базовыми из файла settings.ini.

Т.о. можно из скрипта определять в какую группу, чат, адрес почты отправлять сообщение, переопределяя базовые параметры.
Возможно указывать только параметры отличные от базовых.